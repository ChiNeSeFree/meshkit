{{extend 'layout.html'}}
{{footer_enable=True}}
<h1>{{=T('1. Basic configuration')}}</h1>

<div id="custom_text_start">
	{{=XML(startpage)}}
</div>

{{if config.documentation_url:}}
<div id="docurl">
  {{=XML(T('If you need help with Meshkit please see: %(url)s.') %
         dict(url='<a href="' + config.documentation_url + '">' + T('Meshkit Documentation') + '</a>'))}}
</div>
{{pass}}


{{
    fh = formhelpers.customField(form, "imageconf")
}}


<!-- form start -->

<form method="post" name="step1" enctype="multipart/form-data" class="form-horizontal border-top border-bottom" action="">
    {{if config.communitysupport == True:}}
        {{=fh.field("community")}}
    {{pass}} 

    {{=fh.field("target")}}

    {{if config.showexpertmode == True:}}
        {{=fh.field("expert")}}
    {{pass}}

    {{if not config.noconf == True:}}
        {{=fh.field("noconf")}}
    {{pass}}

    {{=fh.field("mail")}}


    {{ if config.autosubmit != True: }}
    <input type="submit" class="btn btn-default btn-primary" value="{{=T('Go to step 2')}}"/ >
    {{pass}}
    
    <input type="hidden" name="profile" id="imageconf_profile"/>
    <input type="hidden" name="_formname" value="step1" />
</form>
<!-- form end -->

<div style="height:35px"></div>

<h2>{{=T('Select by model')}}</h2>
<p>{{=T('You may select some known router models below. The target on this page and the profile on the next page will automatically be set for you then.')}}<br />
{{=T('If your model is not shown below then continue by setting target and profile (on the next page) manually.')}}</p>

<div id="modellist">
</div>
<script type="text/javascript">

var modellist = {{=XML(modellist)}};
var target_options = document.getElementById('imageconf_target').options;
var target_hiddenvalue = document.getElementById('imageconf_target').value;

function target_rewrite(target) {
    for(option in target_options) {
	var ret;
	if(typeof target_options[option].value != "undefined"){
          if (target_options[option].value.match(target)) {
             ret = target_options[option].value;
          }
	}
    }
    if (typeof ret == "undefined") {
       ret = target_hiddenvalue
    }
    return ret;
}


function set_target(target) {
    $('select[name="target"]').val(target);
}

function set_profile(profile) {
    $('input[name="profile"]').val(profile);
}

var list = "<table>";

for(var manufacturer in modellist) {
  var len = Object.keys(modellist[manufacturer]).length;
  list += '<tr>';
  list += '<th>' + manufacturer + '</th>';
  var i = 1;
  for(var model in modellist[manufacturer]) {
    list += '<td>';
    var target = modellist[manufacturer][model]['target'];
    var profile = modellist[manufacturer][model]['profile'];
    var full_target = target_rewrite(target);
    msg = '{{=T('Selected')}} ' + model + '<ul><li>{{=T('Target')}}: ' + full_target + '</li><li>{{=T('Profile')}}: ' + profile + '</li></ul>';
    link = "<a href='javascript:void(0)' onclick='set_target(\"" + full_target + "\");"
    link += "set_profile(\"" + profile + "\");";
    {{ if config.autosubmit == True: }}
        link += "document.step1.submit();";
    {{pass}}
    link += "jQuery(\".flash\").html(" + "\"" + msg + "\"" + ").slideDown()'>" + model + "</a>";
    if( typeof full_target != "undefined") {
      if(i < len) {
        list += link + " | "
      } else {
        list += link;
      }
    }
    i++;
  }
  list += '</td></tr>';
list += "</table";
}


document.getElementById('modellist').innerHTML = list

</script>

{{block footer}}
{{include 'footer.html'}}
{{end}}
